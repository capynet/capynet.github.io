<!DOCTYPE html>
<html lang="es-ES">

<!-- Mirrored from ecapy.com/migrate-drupal-commerce-product-display/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Dec 2016 15:34:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Capy |   Combo: Importar y sincronizar productos con Migrate + Drupal commerce + product display desde CSV/XML/JSON</title>
			<link rel="shortcut icon" href="../wp-content/uploads/2016/01/1454276298_globe-01.png" type="image/x-icon"/>
		<link rel="stylesheet" type="text/css" href="#">

	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="../xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://ecapy.com/wp-content/themes/prolog/js/html5.js"></script>
	<![endif]-->

	<link rel='dns-prefetch' href='http://fonts.googleapis.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Capy &raquo; Feed" href="../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Capy &raquo; RSS de los comentarios" href="../comments/feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/ecapy.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-theme-sublime-text-css'  href='../wp-content/plugins/crayon-syntax-highlighter/themes/sublime-text/sublime-text2f6a.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='../wp-content/plugins/crayon-syntax-highlighter/fonts/monaco2f6a.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='thm-style-css'  href='../wp-content/themes/prolog/style1c9b.css?ver=4.6.1' type='text/css' media='all' />
<link rel='stylesheet' id='font-awesome-css'  href='../wp-content/themes/prolog/css/font-awesome.min1c9b.css?ver=4.6.1' type='text/css' media='all' />
<link rel='stylesheet' id='quick-style-css'  href='../wp-content/themes/prolog/quick-style1c9b.css?ver=4.6.1' type='text/css' media='all' />
<link rel='stylesheet' id='themeum-preset-css'  href='../wp-content/themes/prolog/css/presets/preset31c9b.css?ver=4.6.1' type='text/css' media='all' />
<link rel='stylesheet' id='redux-google-fonts-css'  href='http://fonts.googleapis.com/css?family=Open+Sans%7CRoboto+Slab%3A100%2C300%2C400%2C700&amp;ver=1454375832' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Drupal: Obtener un árbol de términos de forma anidada' href='../drupal-obtener-un-arbol-de-terminos-de-forma-anidada/index.html' />
<link rel='next' title='Actualizar solo un paquete en Linux' href='../actualizar-solo-un-paquete-en-linux/index.html' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='../index99a0.html?p=2366' />
<link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embedd33d.json?url=http%3A%2F%2Fecapy.com%2Fmigrate-drupal-commerce-product-display%2F" />
<link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embed8493?url=http%3A%2F%2Fecapy.com%2Fmigrate-drupal-commerce-product-display%2F&amp;format=xml" />
<style type="text/css" title="dynamic-css" class="options-output">body, p{font-family:Open Sans;font-weight:normal;font-style:normal;color:#1a1a1a;font-size:16px;}h1, h2, h3, h4, h5, h6{font-family:Roboto Slab;font-weight:400;font-style:normal;color:#1a1a1a;}#navigation .navbar-nav > li > a, .navbar-main .dropdown-menu > li > a{font-family:Open Sans;font-weight:normal;font-style:normal;color:#777777;font-size:16px;}</style></head>

<body class="single single-post postid-2366 single-format-standard">
	<div id="page" class="hfeed site">
		<header id="masthead" class="site-header header" role="banner">
			<div class="container">
				<div id="navigation" class="navbar navbar-default">
                    <div class="row">
                        <div class="col-sm-3">
        					<div class="navbar-header">
        						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        							<span class="icon-bar"></span>
        							<span class="icon-bar"></span>
        							<span class="icon-bar"></span>
        						</button>
        	                    <a class="navbar-brand" href="../index.html">
        	                    	<h1 class="logo-wrapper">
        		                    	Capy        		                    </h1>
        		                </a>
        					</div>
                        </div>

                        <div id="main-menu" class="col-sm-9">
                            <div class="hidden-xs">
                                <ul id="menu-principal" class="nav navbar-nav navbar-main"><li id="menu-item-2961" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-2961"><a title="Drupal" href="../category/drupal/index.html"><span class="fa fa-drupal"></span>&nbsp;Drupal</a></li>
<li id="menu-item-2959" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2959"><a title="CSS y Maquetación" href="../category/css-y-maquetacion/index.html">CSS y Maquetación</a></li>
<li id="menu-item-2958" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2958"><a title="PHP" href="../category/php/index.html">PHP</a></li>
<li id="menu-item-2960" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2960"><a title="Javascript" href="../category/js/index.html">Javascript</a></li>
</ul>                            </div>
                        </div><!--/#main-menu-->

                        <div id="mobile-menu" class="visible-xs">
                            <div class="collapse navbar-collapse">
                                <ul id="menu-principal-1" class="nav navbar-nav"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-2961 active"><a title="Drupal" href="../category/drupal/index.html"><span class="glyphicon drupal"></span>&nbsp;Drupal</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2959"><a title="CSS y Maquetación" href="../category/css-y-maquetacion/index.html">CSS y Maquetación</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2958"><a title="PHP" href="../category/php/index.html">PHP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2960"><a title="Javascript" href="../category/js/index.html">Javascript</a></li>
</ul>                            </div>
                        </div><!--/.#mobile-menu-->

                    </div><!--/.row--> 
				</div><!--/.container--> 
			</div>
		</header><!--/#header-->


    <section id="main" class="container">
        <div class="row">
            <div id="content" class="site-content col-md-9" role="main">

                
                    
                        <article id="post-2366" class="post-2366 post type-post status-publish format-standard has-post-thumbnail hentry category-drupal tag-drupal tag-drupal-7 tag-migraciones">
    <header class="entry-header">

            <div class="entry-thumbnail">
            <img width="850" height="253" src="../wp-content/uploads/2015/07/drupal-header.jpg" class="img-responsive wp-post-image" alt="drupal-header" srcset="http://ecapy.com/wp-content/uploads/2015/07/drupal-header.jpg 850w, http://ecapy.com/wp-content/uploads/2015/07/drupal-header-300x89.jpg 300w, http://ecapy.com/wp-content/uploads/2015/07/drupal-header-768x229.jpg 768w" sizes="(max-width: 850px) 100vw, 850px" />        </div>
    
    </header> <!--/.entry-header -->

    <div class="clearfix post-content media">
        <div class="pull-left">
            <h4 class="post-format">
                <i class="fa fa-thumb-tack"></i>
            </h4>

        </div>
    

    <div class="media-body">
        <h2 class="entry-title">
            <a href="index.html" rel="bookmark">Combo: Importar y sincronizar productos con Migrate + Drupal commerce + product display desde CSV/XML/JSON</a>
                    </h2> <!-- //.entry-title -->

        <div class="clearfix entry-meta">
            <ul>
                                <li class="author"> <i class="fa fa-user"></i> <a href="../author/capynet/index.html" title="Entradas de capynet" rel="author">capynet</a></li> 
                
                                <li class="publish-date"><i class="fa fa-calendar"></i><time class="entry-date" datetime="2013-07-01T10:15:42+00:00">1 Jul,  2013</time></li>  
                
                                <li class="category"><i class="fa fa-folder-open-o"></i><a href="../category/drupal/index.html" rel="category tag">Drupal</a></li>
                                
                                <li class="tag"><i class="fa fa-tags"></i><a href="../tag/drupal/index.html" rel="tag">Drupal</a>, <a href="../tag/drupal-7/index.html" rel="tag">Drupal 7</a>, <a href="../tag/migraciones/index.html" rel="tag">Migraciones</a><br /> </li>
                
                 
                                
                                    <li class="edit-link">
                                             </li>
                            </ul>
        </div> <!--/.entry-meta -->

        <div class="entry-summary">
            <p>Hola!. <a title="Drupal: Importar y sincronizar desde una DB con Migrate" href="../drupal-importar-y-sincronizar-desde-una-db-con-migrate/index.html" target="_blank">Todos</a> <a title="Drupal: Importar y sincronizar desde un XML local o remoto con Migrate" href="../drupal-importar-y-sincronizar-desde-un-xml-local-o-remoto-con-migrate/index.html" target="_blank">los</a> <a title="Drupal: Importar y sincronizar desde un CSV con Migrate" href="../drupal-importar-y-sincronizar-desde-un-csv-con-migrate/index.html" target="_blank">post</a> <a title="Drupal: Importar y sincronizar desde un JSON local o remoto con Migrate" href="../drupal-importar-y-sincronizar-desde-un-json-local-o-remoto-con-migrate/index.html" target="_blank">que</a> <a title="Drupal: Migrate" href="../drupal-migrate/index.html" target="_blank">escribí</a> hasta ahora sobre Migrate se debieron a que quería hacer esto.</p>
<p>Hoy les presento una clase basada en <a href="https://drupal.org/project/migrate" target="_blank">Migrate</a> para importar productos a <a href="https://drupal.org/project/commerce" target="_blank">Drupal Commerce</a> y crear al mismo tiempo un product display.<br />
NOTA: los múltiples productos para un solo product display lo dejamos para otro día 🙁</p>
<h3>Un poco de intro</h3>
<ul>
<li>Necesitamos el modulo <a href="http://drupal.org/project/commerce_migrate" target="_blank">Commerce Migrate</a> para poder crear productos con Migrate.</li>
<li>El machine name del tipo de producto que vamos a importar se llama &#8220;<em>gorras</em>&#8220;</li>
<li>El machine name del product display que vamos a importar se llama &#8220;<em>display_gorra</em>&#8220;</li>
<li>Indistintamente del formato a importar (xml, json, csv) existen dos clases linkeadas: la que crea el producto y la que crea el porduct display y asigna el producto creado.</li>
<li>La fuente de información para cada una de las clases es la misma siempre, solo que cada clase toma lo que necesita.</li>
<li>El linkeo entre clases se hace referenciando el machine name que usaste para registrar la clase (machine-name != class name). Si no lo tenés claro <a title="Drupal: Migrate" href="../drupal-migrate/index.html" target="_blank">lee este post</a></li>
</ul>
<p>Bueno vamos a hacer una cosa, en lugar de repetir las dos clases necesarias para la importación por cada tipo de source, voy a dejar aqui solo la que importa CSV, porque el resto de las clases funcionan practicamente igual, y seria repetir en vano.</p>
<h3>LAS CLASES</h3>
<p></p>
		<div id="crayon-584436ba127ac297207213" class="crayon-syntax crayon-theme-sublime-text crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover disable-anim" style=" margin-top: 12px; margin-bottom: 12px; ">
		
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; ">
/**
 * Class ProductFromCSV
 * Crea el producto
 * machine-name: product-from-csv
 */
class ProductFromCSV extends Migration {
 
  public function __construct($arguments) {
 
    parent::__construct($arguments);
 
    $csv_path = "/path/hasta/el/csv/exported.csv";
 
    $columns = array(
      0 =&gt; array('identificador', 'Identificador'),
      1 =&gt; array('titulo', 'Post date'),
      2 =&gt; array('precio', 'Precio'),
      3 =&gt; array('moneda', 'Moneda'),
      4 =&gt; array('categoria', 'Categoría'),
    );
 
    $this-&gt;source = new MigrateSourceCSV($csv_path, $columns, array('embedded_newlines' =&gt; TRUE, "track_changes" =&gt; TRUE));
 
    $this-&gt;destination = new MigrateDestinationEntityAPI('commerce_product', 'gorras');
 
    $this-&gt;map = new MigrateSQLMap($this-&gt;machineName,
      array(
        'identificador' =&gt; array(
          'type' =&gt; 'varchar',
          'length' =&gt; 20,
          'not null' =&gt; TRUE,
        ),
      ),
      $this-&gt;destination-&gt;getKeySchema()
    );
 
    global $user;
 
    $this-&gt;addFieldMapping('title', 'titulo');
    $this-&gt;addFieldMapping('commerce_price', 'precio')-&gt;defaultValue(0);
    $this-&gt;addFieldMapping('commerce_price:currency_code', 'moneda')-&gt;defaultValue(commerce_default_currency());
    $this-&gt;addFieldMapping('sku', 'identificador');
    $this-&gt;addFieldMapping('status')-&gt;defaultValue(1);
    $this-&gt;addFieldMapping('uid')-&gt;defaultValue($user-&gt;uid);
    $this-&gt;addFieldMapping('field_categoria', 'categoria')-&gt;defaultValue("General");
 
  }
}
 
/**
 * Class ProductDisplayFromCSV
 * Crea product displays (de momento solo pueden crear relaciones 1-1)
 * machine-name: product-display-from-csv
 */
class ProductDisplayFromCSV extends Migration {
 
  public function __construct($arguments) {
 
    parent::__construct($arguments);
 
    $csv_path = "/path/hasta/el/csv/exported.csv";
    //Suponiendo que la clase la has registrado bajo este nombre :D
    $product_machine_name = 'product-from-csv';
 
    $columns = array(
      0 =&gt; array('identificador', 'Identificador'),
      1 =&gt; array('titulo', 'Post date'),
    );
 
    $this-&gt;source = new MigrateSourceCSV($csv_path, $columns, array('embedded_newlines' =&gt; TRUE, "track_changes" =&gt; TRUE));
 
    $this-&gt;dependencies = array($product_machine_name);
 
    $this-&gt;destination = new MigrateDestinationNode('display_gorra');
 
    $this-&gt;map = new MigrateSQLMap($this-&gt;machineName,
      array(
        'identificador' =&gt; array(
          'type' =&gt; 'varchar',
          'length' =&gt; 20,
          'not null' =&gt; TRUE,
        ),
      ),
      $this-&gt;destination-&gt;getKeySchema()
    );
 
    global $user;
 
    $this-&gt;addFieldMapping('uid')-&gt;defaultValue($user-&gt;uid);
    $this-&gt;addFieldMapping('title', 'titulo');
    $this-&gt;addFieldMapping('field_product', "identificador")-&gt;sourceMigration($product_machine_name);
  }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style=""><div class="crayon-num" data-line="crayon-584436ba127ac297207213-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-2">2</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-4">4</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-6">6</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-8">8</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-10">10</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-12">12</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-14">14</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-16">16</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-18">18</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-20">20</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-22">22</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-24">24</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-26">26</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-28">28</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-30">30</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-32">32</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-34">34</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-36">36</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-38">38</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-40">40</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-42">42</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-44">44</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-46">46</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-48">48</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-50">50</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-52">52</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-54">54</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-56">56</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-58">58</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-60">60</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-62">62</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-64">64</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-66">66</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-68">68</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-70">70</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-72">72</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-74">74</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-76">76</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-78">78</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-80">80</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-82">82</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-84">84</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-86">86</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-88">88</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-90">90</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-584436ba127ac297207213-92">92</div><div class="crayon-num" data-line="crayon-584436ba127ac297207213-93">93</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style=" -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-584436ba127ac297207213-1"><span class="crayon-c">/**</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-2"><span class="crayon-c"> * Class ProductFromCSV</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-3"><span class="crayon-c"> * Crea el producto</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-4"><span class="crayon-c"> * machine-name: product-from-csv</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-5"><span class="crayon-c"> */</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-6"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">ProductFromCSV</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-e">Migration</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-7"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">__construct</span><span class="crayon-sy">(</span><span class="crayon-v">$arguments</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-9"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">parent</span><span class="crayon-o">::</span><span class="crayon-e">__construct</span><span class="crayon-sy">(</span><span class="crayon-v">$arguments</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-11"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$csv_path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"/path/hasta/el/csv/exported.csv"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-13"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">'identificador'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Identificador'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">'titulo'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Post date'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">'precio'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Precio'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">'moneda'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Moneda'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">4</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">'categoria'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Categoría'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-21"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MigrateSourceCSV</span><span class="crayon-sy">(</span><span class="crayon-v">$csv_path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">'embedded_newlines'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">TRUE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"track_changes"</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">TRUE</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-23"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">destination</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MigrateDestinationEntityAPI</span><span class="crayon-sy">(</span><span class="crayon-s">'commerce_product'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'gorras'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-25"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">map</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MigrateSQLMap</span><span class="crayon-sy">(</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">machineName</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'identificador'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'type'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'varchar'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'length'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'not null'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">TRUE</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">destination</span><span class="crayon-o">-&gt;</span><span class="crayon-e">getKeySchema</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-36"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-v">$user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-38"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'title'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'titulo'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'commerce_price'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'precio'</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-e">defaultValue</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'commerce_price:currency_code'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'moneda'</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-e">defaultValue</span><span class="crayon-sy">(</span><span class="crayon-e">commerce_default_currency</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'sku'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'identificador'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'status'</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-e">defaultValue</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'uid'</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-e">defaultValue</span><span class="crayon-sy">(</span><span class="crayon-v">$user</span><span class="crayon-o">-&gt;</span><span class="crayon-i">uid</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'field_categoria'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'categoria'</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-e">defaultValue</span><span class="crayon-sy">(</span><span class="crayon-s">"General"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-46"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-47"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-48"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-49"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-50"><span class="crayon-c">/**</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-51"><span class="crayon-c"> * Class ProductDisplayFromCSV</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-52"><span class="crayon-c"> * Crea product displays (de momento solo pueden crear relaciones 1-1)</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-53"><span class="crayon-c"> * machine-name: product-display-from-csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-54"><span class="crayon-c"> */</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-55"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">ProductDisplayFromCSV</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-e">Migration</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-56"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-57"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">__construct</span><span class="crayon-sy">(</span><span class="crayon-v">$arguments</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-58"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">parent</span><span class="crayon-o">::</span><span class="crayon-e">__construct</span><span class="crayon-sy">(</span><span class="crayon-v">$arguments</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-60"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$csv_path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"/path/hasta/el/csv/exported.csv"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">//Suponiendo que la clase la has registrado bajo este nombre :D</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$product_machine_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'product-from-csv'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-64"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">'identificador'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Identificador'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">'titulo'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Post date'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-69"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MigrateSourceCSV</span><span class="crayon-sy">(</span><span class="crayon-v">$csv_path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">$columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-s">'embedded_newlines'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">TRUE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"track_changes"</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">TRUE</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-71"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">dependencies</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">$product_machine_name</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-73"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">destination</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MigrateDestinationNode</span><span class="crayon-sy">(</span><span class="crayon-s">'display_gorra'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-75"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">map</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MigrateSQLMap</span><span class="crayon-sy">(</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">machineName</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'identificador'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'type'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'varchar'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'length'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'not null'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">TRUE</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">destination</span><span class="crayon-o">-&gt;</span><span class="crayon-e">getKeySchema</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-86"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-v">$user</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-88"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'uid'</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-e">defaultValue</span><span class="crayon-sy">(</span><span class="crayon-v">$user</span><span class="crayon-o">-&gt;</span><span class="crayon-i">uid</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'title'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'titulo'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'field_product'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"identificador"</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-e">sourceMigration</span><span class="crayon-sy">(</span><span class="crayon-v">$product_machine_name</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-584436ba127ac297207213-92"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-584436ba127ac297207213-93"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div><p>Lo importante aquí es notar que la segunda clase &#8220;dice&#8221; que depende de la primera al indicar <em>$this-&gt;dependencies = array($product_machine_name);</em>. De esta forma, Migrate sabe que la segunda clase no se puede poner a importar hasta que el primer migrador haya sido procesado.<br />
Y para establecer la relación con el producto creado asociamos el field &#8220;<em>field_product</em>&#8221; al identificador que a su vez lo obtiene de la relación que Migrate estableció en una tabla en la DB (relación identificador del CSV &lt; -&gt; commerce product ID) por medio de <em>-&gt;sourceMigration()</em></p>
<h4>Uso:</h4>
<p>La verdad que fui un iluso cuando pensé que por estar linkeadas, las clases se iban a ejecutar en cadena :S La realidad es que siguen siendo migrators independientes con la salvedad de que hay que ejecutarlos en orden:</p>
		<div id="crayon-584436ba127ba893720239" class="crayon-syntax crayon-theme-sublime-text crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover disable-anim" style=" margin-top: 12px; margin-bottom: 12px; ">
		
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; ">
drush mi product-from-csv</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style=""><div class="crayon-num" data-line="crayon-584436ba127ba893720239-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style=" -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-584436ba127ba893720239-1"><span class="crayon-e">drush </span><span class="crayon-e">mi </span><span class="crayon-v">product</span><span class="crayon-o">-</span><span class="crayon-v">from</span><span class="crayon-o">-</span><span class="crayon-v">csv</span></div></div></td>
					</tr>
				</table>
			</div>
		</div><p>Y recién ahora podemos invocar al migrator que crea los product display:</p>
		<div id="crayon-584436ba127bf348659276" class="crayon-syntax crayon-theme-sublime-text crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover disable-anim" style=" margin-top: 12px; margin-bottom: 12px; ">
		
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; ">
drush mi product-display-from-csv</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style=""><div class="crayon-num" data-line="crayon-584436ba127bf348659276-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style=" -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-584436ba127bf348659276-1"><span class="crayon-e">drush </span><span class="crayon-e">mi </span><span class="crayon-v">product</span><span class="crayon-o">-</span><span class="crayon-v">display</span><span class="crayon-o">-</span><span class="crayon-v">from</span><span class="crayon-o">-</span><span class="crayon-v">csv</span></div></div></td>
					</tr>
				</table>
			</div>
		</div><p>That&#8217;s all.<br />
Chau!</p>
        </div> <!-- //.entry-summary -->
            </div>
 

    </div>

</article> <!--/#post-->
                                                     <div class="clearfix post-navigation">
                                <span class="btn-style previous-post pull-left"><a href="../drupal-obtener-un-arbol-de-terminos-de-forma-anidada/index.html" rel="prev"><i class="fa fa-long-arrow-left"></i> previous article</a></span>                                 <span class="btn-style next-post pull-right"><a href="../actualizar-solo-un-paquete-en-linux/index.html" rel="next">next article <i class="fa fa-long-arrow-right"></i></a></span>                            </div> <!-- .post-navigation -->
                                            
                                                                    
                    
                        
            </div> <!-- #content -->

            <div id="sidebar" class="col-md-3" role="complementary">
                

	<div class="my-profile clearfix">
		<div class="profile-bg">
						<img class="img-responsive" src="../wp-content/uploads/2016/01/14567-brick-wall-and-wood-floor-1920x1200-abstract-wallpaper.jpg">
			
						<div class="profile-img">
				<img class="img-responsive" src="../wp-content/uploads/2016/01/IMG-20150521-WA0007-1.jpg">
			</div>
					</div>

		<div class="profile-desc">
							<h2>Capy (Marcelo Tosco)</h2>
										<span>Desarrollador web</span>
									<p>Hola!. en mi blog casi siempre escribo sobre informática, pero no te extrañes si algún día aparece un post que no tenga nada que ver a lo que estés acostumbrado ;)</p>
					</div>

		
<div class="social-share">
	
	<ul>
		
			
			<li><a class="twitter" href="http://twitter.com/capynet" target="_blank" ><i class="fa fa-twitter"></i></a></li>
									<li><a class="linkedin" href="https://es.linkedin.com/in/capynet" target="_blank"><i class="fa fa-linkedin"></i></a></li>
											 
		
	</ul>
	
</div>




	</div>

                <div class="sidebar-inner">
                    <aside class="widget-area">
                                            </aside>
                </div>
            </div> <!-- #sidebar -->

        </div> <!-- .row -->
    </section> <!-- .container -->


        <footer id="footer">
        <div class="container">
            <div class="footer">
                <div class="row">
                                            <div class="col-sm-6">
                          <a href="http://asociaciondrupal.es/" target="_blank"><img class="alignnone size-full wp-image-3123" src="../wp-content/uploads/2016/01/miembro-aed_150x75.jpg" alt="miembro-aed_150x75" width="150" height="75" /></a>                        </div>
                    
                                    </div>
            </div>
        </div>
    </footer><!--/#footer-->
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-238596-8', 'auto');
  ga('send', 'pageview');

</script>
<link rel='stylesheet' id='crayon-css'  href='../wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min2f6a.css?ver=_2.7.2_beta' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/imagesloaded.min55a0.js?ver=3.2.0'></script>
<script type='text/javascript' src='../wp-includes/js/masonry.mind617.js?ver=3.3.2'></script>
<script type='text/javascript' src='../wp-content/themes/prolog/js/bootstrap.min1c9b.js?ver=4.6.1'></script>
<script type='text/javascript' src='../wp-content/themes/prolog/js/jquery.prettyPhoto1c9b.js?ver=4.6.1'></script>
<script type='text/javascript' src='../wp-content/themes/prolog/js/jquery.countdown.min1c9b.js?ver=4.6.1'></script>
<script type='text/javascript' src='../wp-content/themes/prolog/js/main1c9b.js?ver=4.6.1'></script>
<script type='text/javascript' src='../wp-includes/js/wp-embed.min1c9b.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/ecapy.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Presiona %s para copiar y %s para pegar","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min2f6a.js?ver=_2.7.2_beta'></script>
</body>

<!-- Mirrored from ecapy.com/migrate-drupal-commerce-product-display/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Dec 2016 15:34:10 GMT -->
</html>