<!DOCTYPE html>
<html lang="es-ES">

<!-- Mirrored from ecapy.com/drupal-importar-y-sincronizar-desde-una-db-con-migrate/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Dec 2016 15:36:58 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Capy |   Drupal: Importar y sincronizar desde una DB con Migrate</title>
			<link rel="shortcut icon" href="../wp-content/uploads/2016/01/1454276298_globe-01.png" type="image/x-icon"/>
		<link rel="stylesheet" type="text/css" href="#">

	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="../xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://ecapy.com/wp-content/themes/prolog/js/html5.js"></script>
	<![endif]-->

	<link rel='dns-prefetch' href='http://fonts.googleapis.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Capy &raquo; Feed" href="../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Capy &raquo; RSS de los comentarios" href="../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Capy &raquo; Drupal: Importar y sincronizar desde una DB con Migrate RSS de los comentarios" href="feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/ecapy.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-theme-sublime-text-css'  href='../wp-content/plugins/crayon-syntax-highlighter/themes/sublime-text/sublime-text2f6a.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='../wp-content/plugins/crayon-syntax-highlighter/fonts/monaco2f6a.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='thm-style-css'  href='../wp-content/themes/prolog/style1c9b.css?ver=4.6.1' type='text/css' media='all' />
<link rel='stylesheet' id='font-awesome-css'  href='../wp-content/themes/prolog/css/font-awesome.min1c9b.css?ver=4.6.1' type='text/css' media='all' />
<link rel='stylesheet' id='quick-style-css'  href='../wp-content/themes/prolog/quick-style1c9b.css?ver=4.6.1' type='text/css' media='all' />
<link rel='stylesheet' id='themeum-preset-css'  href='../wp-content/themes/prolog/css/presets/preset31c9b.css?ver=4.6.1' type='text/css' media='all' />
<link rel='stylesheet' id='redux-google-fonts-css'  href='http://fonts.googleapis.com/css?family=Open+Sans%7CRoboto+Slab%3A100%2C300%2C400%2C700&amp;ver=1454375832' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Drupal: Migrate' href='../drupal-migrate/index.html' />
<link rel='next' title='Drupal: Importar y sincronizar desde un XML local o remoto con Migrate' href='../drupal-importar-y-sincronizar-desde-un-xml-local-o-remoto-con-migrate/index.html' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='../indexb6be.html?p=2278' />
<link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embedc0e5.json?url=http%3A%2F%2Fecapy.com%2Fdrupal-importar-y-sincronizar-desde-una-db-con-migrate%2F" />
<link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embed13f9?url=http%3A%2F%2Fecapy.com%2Fdrupal-importar-y-sincronizar-desde-una-db-con-migrate%2F&amp;format=xml" />
<style type="text/css" title="dynamic-css" class="options-output">body, p{font-family:Open Sans;font-weight:normal;font-style:normal;color:#1a1a1a;font-size:16px;}h1, h2, h3, h4, h5, h6{font-family:Roboto Slab;font-weight:400;font-style:normal;color:#1a1a1a;}#navigation .navbar-nav > li > a, .navbar-main .dropdown-menu > li > a{font-family:Open Sans;font-weight:normal;font-style:normal;color:#777777;font-size:16px;}</style></head>

<body class="single single-post postid-2278 single-format-standard">
	<div id="page" class="hfeed site">
		<header id="masthead" class="site-header header" role="banner">
			<div class="container">
				<div id="navigation" class="navbar navbar-default">
                    <div class="row">
                        <div class="col-sm-3">
        					<div class="navbar-header">
        						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        							<span class="icon-bar"></span>
        							<span class="icon-bar"></span>
        							<span class="icon-bar"></span>
        						</button>
        	                    <a class="navbar-brand" href="../index.html">
        	                    	<h1 class="logo-wrapper">
        		                    	Capy        		                    </h1>
        		                </a>
        					</div>
                        </div>

                        <div id="main-menu" class="col-sm-9">
                            <div class="hidden-xs">
                                <ul id="menu-principal" class="nav navbar-nav navbar-main"><li id="menu-item-2961" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-2961"><a title="Drupal" href="../category/drupal/index.html"><span class="fa fa-drupal"></span>&nbsp;Drupal</a></li>
<li id="menu-item-2959" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2959"><a title="CSS y Maquetación" href="../category/css-y-maquetacion/index.html">CSS y Maquetación</a></li>
<li id="menu-item-2958" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2958"><a title="PHP" href="../category/php/index.html">PHP</a></li>
<li id="menu-item-2960" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2960"><a title="Javascript" href="../category/js/index.html">Javascript</a></li>
</ul>                            </div>
                        </div><!--/#main-menu-->

                        <div id="mobile-menu" class="visible-xs">
                            <div class="collapse navbar-collapse">
                                <ul id="menu-principal-1" class="nav navbar-nav"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-2961 active"><a title="Drupal" href="../category/drupal/index.html"><span class="glyphicon drupal"></span>&nbsp;Drupal</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2959"><a title="CSS y Maquetación" href="../category/css-y-maquetacion/index.html">CSS y Maquetación</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2958"><a title="PHP" href="../category/php/index.html">PHP</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2960"><a title="Javascript" href="../category/js/index.html">Javascript</a></li>
</ul>                            </div>
                        </div><!--/.#mobile-menu-->

                    </div><!--/.row--> 
				</div><!--/.container--> 
			</div>
		</header><!--/#header-->


    <section id="main" class="container">
        <div class="row">
            <div id="content" class="site-content col-md-9" role="main">

                
                    
                        <article id="post-2278" class="post-2278 post type-post status-publish format-standard has-post-thumbnail hentry category-drupal category-programacion tag-drupal tag-drupal-7 tag-migraciones">
    <header class="entry-header">

            <div class="entry-thumbnail">
            <img width="850" height="253" src="../wp-content/uploads/2015/07/drupal-header.jpg" class="img-responsive wp-post-image" alt="drupal-header" srcset="http://ecapy.com/wp-content/uploads/2015/07/drupal-header.jpg 850w, http://ecapy.com/wp-content/uploads/2015/07/drupal-header-300x89.jpg 300w, http://ecapy.com/wp-content/uploads/2015/07/drupal-header-768x229.jpg 768w" sizes="(max-width: 850px) 100vw, 850px" />        </div>
    
    </header> <!--/.entry-header -->

    <div class="clearfix post-content media">
        <div class="pull-left">
            <h4 class="post-format">
                <i class="fa fa-thumb-tack"></i>
            </h4>

        </div>
    

    <div class="media-body">
        <h2 class="entry-title">
            <a href="index.html" rel="bookmark">Drupal: Importar y sincronizar desde una DB con Migrate</a>
                    </h2> <!-- //.entry-title -->

        <div class="clearfix entry-meta">
            <ul>
                                <li class="author"> <i class="fa fa-user"></i> <a href="../author/capynet/index.html" title="Entradas de capynet" rel="author">capynet</a></li> 
                
                                <li class="publish-date"><i class="fa fa-calendar"></i><time class="entry-date" datetime="2013-06-14T10:00:39+00:00">14 Jun,  2013</time></li>  
                
                                <li class="category"><i class="fa fa-folder-open-o"></i><a href="../category/drupal/index.html" rel="category tag">Drupal</a>, <a href="../category/programacion/index.html" rel="category tag">Programación</a></li>
                                
                                <li class="tag"><i class="fa fa-tags"></i><a href="../tag/drupal/index.html" rel="tag">Drupal</a>, <a href="../tag/drupal-7/index.html" rel="tag">Drupal 7</a>, <a href="../tag/migraciones/index.html" rel="tag">Migraciones</a><br /> </li>
                
                 
                                    <li class="comments-link">
                        <i class="fa fa-comments-o"></i> <a href="index.html#comments">2 comments</a>                    </li>
                                
                                    <li class="edit-link">
                                             </li>
                            </ul>
        </div> <!--/.entry-meta -->

        <div class="entry-summary">
            <p><a title="Drupal: Migrate" href="../drupal-migrate/index.html" target="_blank">En el post anterior</a> vimos por encima como implementar un migrator, que no es mas que una clase que extiende de Migration. La clase Migration nos quita prácticamente todo el trabajo de encima (en lo que se refiere a procesar la importación y creación de contenidos). Lo único que se necesita para crear un migrator es implementar el método <em>__construct()</em> y decirle donde esta la info que entra, que hace con esa info y la relación de cada fila de un item entrante con respecto a la fila de una entidad.</p>
<p>Dicho lo anterior, el ejemplo de uso para migrar desde DB externas sería:</p>
		<div id="crayon-5844377b1dec5956419511" class="crayon-syntax crayon-theme-sublime-text crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover disable-anim" style=" margin-top: 12px; margin-bottom: 12px; ">
		
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; ">
&lt; ? class WPMigrationFromDB extends Migration { public function __construct($arguments) { // 1 parent::__construct($arguments); // 2 Database::addConnectionInfo('temporal', 'MI_DB', array( 'driver' =&gt; 'mysql',
      'database' =&gt; 'MI_DB',
      'username' =&gt; 'USUARIO',
      'password' =&gt; 'CLAVE',
      'host' =&gt; 'localhost',
    ));

    // 3
    $query = Database::getConnection('MI_DB', 'temporal')
      -&gt;select('wp_posts', 'posts')
      -&gt;fields('posts', array(
        'id',
        'post_title',
        'post_content',
      ))
      -&gt;condition("post_type", "post", "=")
      -&gt;condition("post_status", "publish", "=");

    // 4
    $this-&gt;source = new MigrateSourceSQL($query);

    // 5
    $this-&gt;destination = new MigrateDestinationNode('page');

    // 6
    $this-&gt;map = new MigrateSQLMap($this-&gt;machineName,
      array(
        'id' =&gt; array(
          'type' =&gt; 'int',
          'unsigned' =&gt; TRUE,
          'not null' =&gt; TRUE,
        )
      ),
      MigrateDestinationNode::getKeySchema()
    );

    // 7
    $this-&gt;addFieldMapping('uid')-&gt;defaultValue(1);
    $this-&gt;addFieldMapping('title', 'post_title');
    $this-&gt;addFieldMapping('body', 'post_content');
  }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style=""><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-2">2</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-4">4</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-6">6</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-8">8</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-10">10</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-12">12</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-14">14</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-16">16</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-18">18</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-20">20</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-22">22</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-24">24</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-26">26</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-28">28</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-30">30</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-32">32</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-34">34</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-36">36</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-38">38</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-40">40</div><div class="crayon-num" data-line="crayon-5844377b1dec5956419511-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5844377b1dec5956419511-42">42</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style=" -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5844377b1dec5956419511-1"><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">WPMigrationFromDB</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-e">Migration</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">__construct</span><span class="crayon-sy">(</span><span class="crayon-v">$arguments</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">// 1 parent::__construct($arguments); // 2 Database::addConnectionInfo('temporal', 'MI_DB', array( 'driver' =&gt; 'mysql',</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'database'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'MI_DB'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'username'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'USUARIO'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'password'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'CLAVE'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'host'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'localhost'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// 3</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$query</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Database::</span><span class="crayon-e">getConnection</span><span class="crayon-sy">(</span><span class="crayon-s">'MI_DB'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'temporal'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">-&gt;</span><span class="crayon-e">select</span><span class="crayon-sy">(</span><span class="crayon-s">'wp_posts'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'posts'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">-&gt;</span><span class="crayon-e">fields</span><span class="crayon-sy">(</span><span class="crayon-s">'posts'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'id'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'post_title'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'post_content'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">-&gt;</span><span class="crayon-e">condition</span><span class="crayon-sy">(</span><span class="crayon-s">"post_type"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"post"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"="</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">-&gt;</span><span class="crayon-e">condition</span><span class="crayon-sy">(</span><span class="crayon-s">"post_status"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"publish"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"="</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-18">&nbsp;</div><div class="crayon-line" id="crayon-5844377b1dec5956419511-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// 4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MigrateSourceSQL</span><span class="crayon-sy">(</span><span class="crayon-v">$query</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// 5</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">destination</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MigrateDestinationNode</span><span class="crayon-sy">(</span><span class="crayon-s">'page'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-24">&nbsp;</div><div class="crayon-line" id="crayon-5844377b1dec5956419511-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// 6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">map</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MigrateSQLMap</span><span class="crayon-sy">(</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-i">machineName</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'id'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'type'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-s">'int'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'unsigned'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">TRUE</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'not null'</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">TRUE</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">MigrateDestinationNode::</span><span class="crayon-e">getKeySchema</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-36">&nbsp;</div><div class="crayon-line" id="crayon-5844377b1dec5956419511-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// 7</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'uid'</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-e">defaultValue</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'title'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'post_title'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$this</span><span class="crayon-o">-&gt;</span><span class="crayon-e">addFieldMapping</span><span class="crayon-sy">(</span><span class="crayon-s">'body'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'post_content'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5844377b1dec5956419511-41"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5844377b1dec5956419511-42"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div><p>Enumeré cada uno de los puntos mas importantes:</p>
<ol>
<li>Dejamos que Migration ejecute su constructor</li>
<li><a title="Drupal: conectar a una base de datos externa al vuelo" href="../drupal-conectar-a-una-base-de-datos-externa-al-vuelo/index.html" target="_blank">Conectamos con una DB externa</a></li>
<li>Preparamos la query que va a devolvernos solo las columnas que necesitamos.</li>
<li>Pasamos la query a $this-&gt;source para que sepa desde donde extraer la información.</li>
<li>Especificamos el destino.</li>
<li>Establecemos el mapeo entre los campos extraídos de la DB y los field de la entidad que se va a crear.</li>
</ol>
<p>Y eso es todo lo que necesita una implementación de Migration para procesar la información desde una DB. como siempre, esto es solo un ejemplo rapido para que sepan por donde arrancar, pero si realmente quieren conocer mas sobre implementar un migrator usando de fuente una DB lean <a href="https://drupal.org/node/1152150" target="_blank">https://drupal.org/node/1152150</a></p>
<p>Chau!</p>
        </div> <!-- //.entry-summary -->
            </div>
 

    </div>

</article> <!--/#post-->
                                                     <div class="clearfix post-navigation">
                                <span class="btn-style previous-post pull-left"><a href="../drupal-migrate/index.html" rel="prev"><i class="fa fa-long-arrow-left"></i> previous article</a></span>                                 <span class="btn-style next-post pull-right"><a href="../drupal-importar-y-sincronizar-desde-un-xml-local-o-remoto-con-migrate/index.html" rel="next">next article <i class="fa fa-long-arrow-right"></i></a></span>                            </div> <!-- .post-navigation -->
                                            
                        <div id="comments" class="comments-area comments">
            <h3 class="comments-title">
            2 Comments        </h3>

        <ul class="comment-list">

            		<li class="pingback even thread-even depth-1" id="comment-681">
			<p>Pingback: <a href='../drupal-importar-y-sincronizar-desde-un-xml-local-o-remoto-con-migrate/index.html' rel='external nofollow' class='url'>Drupal: Importar y sincronizar desde un XML local o remoto con Migrate | Capy</a> </p>
		</li><!-- #comment-## -->
		<li class="pingback odd alt thread-odd thread-alt depth-1" id="comment-682">
			<p>Pingback: <a href='../drupal-migrate/index.html' rel='external nofollow' class='url'>Drupal: Migrate | Capy</a> </p>
		</li><!-- #comment-## -->
        </ul><!-- .comment-list -->

        
                <p class="no-comments">:).</p>
        
    
    </div>                                            
                    
                        
            </div> <!-- #content -->

            <div id="sidebar" class="col-md-3" role="complementary">
                

	<div class="my-profile clearfix">
		<div class="profile-bg">
						<img class="img-responsive" src="../wp-content/uploads/2016/01/14567-brick-wall-and-wood-floor-1920x1200-abstract-wallpaper.jpg">
			
						<div class="profile-img">
				<img class="img-responsive" src="../wp-content/uploads/2016/01/IMG-20150521-WA0007-1.jpg">
			</div>
					</div>

		<div class="profile-desc">
							<h2>Capy (Marcelo Tosco)</h2>
										<span>Desarrollador web</span>
									<p>Hola!. en mi blog casi siempre escribo sobre informática, pero no te extrañes si algún día aparece un post que no tenga nada que ver a lo que estés acostumbrado ;)</p>
					</div>

		
<div class="social-share">
	
	<ul>
		
			
			<li><a class="twitter" href="http://twitter.com/capynet" target="_blank" ><i class="fa fa-twitter"></i></a></li>
									<li><a class="linkedin" href="https://es.linkedin.com/in/capynet" target="_blank"><i class="fa fa-linkedin"></i></a></li>
											 
		
	</ul>
	
</div>




	</div>

                <div class="sidebar-inner">
                    <aside class="widget-area">
                                            </aside>
                </div>
            </div> <!-- #sidebar -->

        </div> <!-- .row -->
    </section> <!-- .container -->


        <footer id="footer">
        <div class="container">
            <div class="footer">
                <div class="row">
                                            <div class="col-sm-6">
                          <a href="http://asociaciondrupal.es/" target="_blank"><img class="alignnone size-full wp-image-3123" src="../wp-content/uploads/2016/01/miembro-aed_150x75.jpg" alt="miembro-aed_150x75" width="150" height="75" /></a>                        </div>
                    
                                    </div>
            </div>
        </div>
    </footer><!--/#footer-->
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-238596-8', 'auto');
  ga('send', 'pageview');

</script>
<link rel='stylesheet' id='crayon-css'  href='../wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min2f6a.css?ver=_2.7.2_beta' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/imagesloaded.min55a0.js?ver=3.2.0'></script>
<script type='text/javascript' src='../wp-includes/js/masonry.mind617.js?ver=3.3.2'></script>
<script type='text/javascript' src='../wp-content/themes/prolog/js/bootstrap.min1c9b.js?ver=4.6.1'></script>
<script type='text/javascript' src='../wp-content/themes/prolog/js/jquery.prettyPhoto1c9b.js?ver=4.6.1'></script>
<script type='text/javascript' src='../wp-content/themes/prolog/js/jquery.countdown.min1c9b.js?ver=4.6.1'></script>
<script type='text/javascript' src='../wp-content/themes/prolog/js/main1c9b.js?ver=4.6.1'></script>
<script type='text/javascript' src='../wp-includes/js/wp-embed.min1c9b.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/ecapy.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Presiona %s para copiar y %s para pegar","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min2f6a.js?ver=_2.7.2_beta'></script>
</body>

<!-- Mirrored from ecapy.com/drupal-importar-y-sincronizar-desde-una-db-con-migrate/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Dec 2016 15:36:58 GMT -->
</html>